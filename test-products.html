<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Products - TiqtaQo</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .product-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .product-card h3 { margin: 0 0 10px 0; color: #333; }
        .meta { font-size: 12px; color: #666; margin: 5px 0; }
        .highlight { background: #d4edda; padding: 5px; border-radius: 3px; }
        .debug { background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Test: Packs Homme Products</h1>

    <div id="status" class="status loading">Loading products from Firebase...</div>

    <h2>All Products (Raw from Firebase):</h2>
    <div id="all-products"></div>

    <h2>Packs Homme Products (Filtered):</h2>
    <div id="filtered-products"></div>

    <h2>Debug Information:</h2>
    <div id="debug" class="debug"></div>

    <!-- Load Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmJp754L3V_AAUl6lV4LzE_dUCEFaX_nA",
            authDomain: "tiqtaqo-store.firebaseapp.com",
            projectId: "tiqtaqo-store",
            storageBucket: "tiqtaqo-store.firebasestorage.app",
            messagingSenderId: "747111253966",
            appId: "1:747111253966:web:84c265ac397b644fe28d9f"
        };

        async function testProducts() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const productsRef = collection(db, 'products');
                const snapshot = await getDocs(productsRef);

                const allProducts = [];
                snapshot.forEach(doc => {
                    allProducts.push({ id: doc.id, ...doc.data() });
                });

                // Update status
                document.getElementById('status').className = 'status success';
                document.getElementById('status').textContent = `Found ${allProducts.length} products in Firebase`;

                // Show all products
                const allProductsDiv = document.getElementById('all-products');
                if (allProducts.length === 0) {
                    allProductsDiv.innerHTML = '<p class="status error">No products found in Firebase!</p>';
                } else {
                    allProductsDiv.innerHTML = allProducts.map(p => `
                        <div class="product-card">
                            <h3>${p.name || 'Unnamed'}</h3>
                            <div class="meta">Category: "${p.category || 'N/A'}"</div>
                            <div class="meta">Category (trim): "${(p.category || '').trim()}"</div>
                            <div class="meta">Gender: "${p.gender || 'N/A'}"</div>
                            <div class="meta">Gender (trim): "${(p.gender || '').trim()}"</div>
                            <div class="meta">Gender length: ${(p.gender || '').length}</div>
                            <div class="meta">Gender char codes: ${Array.from(p.gender || '').map(c => c.charCodeAt(0)).join(', ')}</div>
                            <div class="meta">Visible: ${p.visible !== false ? 'Yes' : 'No'}</div>
                        </div>
                    `).join('');
                }

                // Filter for packs homme
                const packsHomme = allProducts.filter(p => {
                    const category = (p.category || '').trim();
                    const gender = (p.gender || '').trim();
                    const isPacks = category === 'packs';
                    const isHomme = gender === 'homme';
                    return isPacks && isHomme;
                });

                // Also try without trim
                const packsHommeNoTrim = allProducts.filter(p => {
                    const isPacks = p.category === 'packs';
                    const isHomme = p.gender === 'homme';
                    return isPacks && isHomme;
                });

                // Show filtered products
                const filteredDiv = document.getElementById('filtered-products');
                if (packsHomme.length === 0) {
                    filteredDiv.innerHTML = `
                        <p class="status error">No Packs Homme products found (with trim)!</p>
                        <p>Packs Homme without trim: ${packsHommeNoTrim.length}</p>
                    `;
                } else {
                    filteredDiv.innerHTML = `
                        <p class="status success">Found ${packsHomme.length} Packs Homme products (with trim)!</p>
                        <p>Packs Homme without trim: ${packsHommeNoTrim.length}</p>
                        ${packsHomme.map(p => `
                            <div class="product-card highlight">
                                <h3>âœ“ ${p.name}</h3>
                                <div class="meta">Category: "${p.category}"</div>
                                <div class="meta">Gender: "${p.gender}"</div>
                            </div>
                        `).join('')}
                    `;
                }

                // Debug info
                const debugDiv = document.getElementById('debug');
                debugDiv.innerHTML = `
                    Total products: ${allProducts.length}
                    <br>
                    Products with category "packs": ${allProducts.filter(p => (p.category || '').trim() === 'packs').length}
                    <br>
                    Products with gender "homme": ${allProducts.filter(p => (p.gender || '').trim() === 'homme').length}
                    <br>
                    Products with gender "homme " (with space): ${allProducts.filter(p => p.gender === 'homme ').length}
                    <br>
                    <br>
                    Debug - comparing values:
                    <br>
                    (p.gender || '').trim() === 'homme': ${(allProducts[0]?.gender || '').trim() === 'homme'}
                    <br>
                    p.gender === 'homme': ${allProducts[0]?.gender === 'homme'}
                    <br>
                    p.gender === 'homme ': ${allProducts[0]?.gender === 'homme '}
                `;

            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = 'Error: ' + error.message;
                document.getElementById('debug').innerHTML = '<pre>' + error.stack + '</pre>';
            }
        }

        testProducts();
    </script>
</body>
</html>
