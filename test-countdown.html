<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ - TiqtaQo</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: #d4af37;
            text-align: center;
        }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #d4af37;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .warning { background: #f39c12; }
        button {
            background: #d4af37;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }
        button:hover {
            background: #f4d03f;
        }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
        }
        .info {
            background: #3498db;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯</h1>
    
    <div class="info">
        <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ø§Ù„Ù‚ ÙÙŠ "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸"ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase. Ø¬Ø±Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙŠØ¯ÙˆÙŠ" Ø£Ø¯Ù†Ø§Ù‡.
    </div>
    
    <div class="test-box">
        <h3>Ø§Ù„Ø­Ø§Ù„Ø©:</h3>
        <div id="firebaseStatus" class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
        <div id="readStatus" class="status warning">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
        <div id="writeStatus" class="status warning">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
    </div>
    
    <div class="test-box">
        <h3>Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ‚Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯:</h3>
        <label>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
        <input type="datetime-local" id="endDateInput" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button onclick="saveCountdownREST()">ğŸ’¾ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙŠØ¯ÙˆÙŠ (REST API)</button>
        <button onclick="readCountdownREST()">ğŸ“– Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
        <button onclick="deleteCountdownREST()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
    </div>
    
    <div class="test-box">
        <h3>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</h3>
        <button onclick="clearLocalStorage()" style="background: #e74c3c; color: white;">ğŸ—‘ï¸ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ù„ÙŠØ©</button>
        <button onclick="testLocalStorageOnly()">ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Firebase</button>
    </div>
    
    <div class="test-box">
        <h3>Ø§Ù„Ø³Ø¬Ù„:</h3>
        <div class="log" id="logBox">...</div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAmJp754L3V_AAUl6lV4LzE_dUCEFaX_nA",
            authDomain: "tiqtaqo-store.firebaseapp.com",
            projectId: "tiqtaqo-store",
            storageBucket: "tiqtaqo-store.firebasestorage.app",
            messagingSenderId: "747111253966",
            appId: "1:747111253966:web:84c265ac397b644fe28d9f"
        };

        const PROJECT_ID = 'tiqtaqo-store';
        const API_KEY = 'AIzaSyAmJp754L3V_AAUl6lV4LzE_dUCEFaX_nA';

        function log(message, type = 'info') {
            const logBox = document.getElementById('logBox');
            const time = new Date().toLocaleTimeString();
            logBox.textContent += `[${time}] ${message}\n`;
            logBox.scrollTop = logBox.scrollHeight;
            console.log(message);
        }

        // Save countdown using REST API
        async function saveCountdownREST() {
            const endDateInput = document.getElementById('endDateInput').value;
            if (!endDateInput) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!');
                return;
            }

            const endDate = new Date(endDateInput).getTime();
            const now = new Date().toISOString();
            
            try {
                document.getElementById('writeStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                document.getElementById('writeStatus').className = 'status warning';
                
                log('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… REST API...');
                log('ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ' + new Date(endDate).toLocaleString());
                
                // Use REST API to save
                const url = `https://firestore.googleapis.com/v1/projects/${PROJECT_ID}/databases/(default)/documents/config/openingOffers?key=${API_KEY}`;
                
                const data = {
                    fields: {
                        endTime: { integerValue: endDate },
                        isActive: { booleanValue: true },
                        updatedAt: { stringValue: now }
                    }
                };
                
                // First try to patch (update)
                try {
                    const response = await fetch(url, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        log('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ø¨Ø± REST API!', 'success');
                        
                        // Save to localStorage as backup
                        localStorage.setItem('openingOffers_endTime', endDate.toString());
                        localStorage.setItem('openingOffers_isActive', 'true');
                        
                        document.getElementById('writeStatus').textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
                        document.getElementById('writeStatus').className = 'status success';
                        
                        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ø¢Ù†:\n1. Ø§ÙØªØ­ ØµÙØ­Ø© "ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©" ÙÙŠ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ ÙˆØ§Ù„Ù‡Ø§ØªÙ\n2. Ø§Ø­Ø°Ù Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ù‡Ø§ØªÙ\n3. Ø³ØªØ¸Ù‡Ø± Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©');
                        
                        return;
                    }
                } catch (e) {
                    log('PATCH failed: ' + e.message);
                }
                
                // If PATCH failed, try POST (create)
                const postUrl = `https://firestore.googleapis.com/v1/projects/${PROJECT_ID}/databases/(default)/documents/config/openingOffers?key=${API_KEY}&documentId=openingOffers`;
                
                const response = await fetch(postUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    log('âœ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ø¨Ø± REST API!', 'success');
                    
                    // Save to localStorage as backup
                    localStorage.setItem('openingOffers_endTime', endDate.toString());
                    localStorage.setItem('openingOffers_isActive', 'true');
                    
                    document.getElementById('writeStatus').textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
                    document.getElementById('writeStatus').className = 'status success';
                    
                    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    throw new Error('REST API failed: ' + response.status);
                }
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + error.message, 'error');
                log('Ø¬Ø±Ø¨ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹...', 'warning');
                
                // Fallback to localStorage
                localStorage.setItem('openingOffers_endTime', endDate.toString());
                localStorage.setItem('openingOffers_isActive', 'true');
                
                log('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage!', 'success');
                document.getElementById('writeStatus').textContent = 'âœ… Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·';
                document.getElementById('writeStatus').className = 'status warning';
                
                alert('Firebase ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹. ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹.\n\nÙ„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ø¨Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙØ¹ÙŠÙ„ CORS ÙÙŠ Firebase Console.');
            }
        }

        // Read countdown using REST API
        async function readCountdownREST() {
            try {
                document.getElementById('readStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...';
                document.getElementById('readStatus').className = 'status warning';
                
                log('Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… REST API...');
                
                const url = `https://firestore.googleapis.com/v1/projects/${PROJECT_ID}/databases/(default)/documents/config/openingOffers?key=${API_KEY}`;
                
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.fields) {
                        const endTime = data.fields.endTime ? data.fields.endTime.integerValue : null;
                        const isActive = data.fields.isActive ? data.fields.isActive.booleanValue : true;
                        
                        log('âœ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase!', 'success');
                        log('  endTime: ' + endTime);
                        log('  isActive: ' + isActive);
                        
                        // Calculate remaining time
                        const now = new Date().getTime();
                        const remaining = endTime - now;
                        
                        if (remaining > 0) {
                            const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                            const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                            
                            log(`Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${days} ÙŠÙˆÙ… ${hours} Ø³Ø§Ø¹Ø© ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© ${seconds} Ø«Ø§Ù†ÙŠØ©`);
                            
                            document.getElementById('readStatus').textContent = `âœ… ${days} ÙŠÙˆÙ… ${hours}:${minutes}:${seconds}`;
                            document.getElementById('readStatus').className = 'status success';
                        } else {
                            log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
                            document.getElementById('readStatus').textContent = 'âŒ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª';
                            document.getElementById('readStatus').className = 'status error';
                        }
                    } else {
                        log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase', 'warning');
                        document.getElementById('readStatus').textContent = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                        document.getElementById('readStatus').className = 'status error';
                    }
                } else if (response.status === 404) {
                    log('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ«ÙŠÙ‚Ø© Ù„Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase', 'warning');
                    
                    // Check localStorage
                    const localEndTime = localStorage.getItem('openingOffers_endTime');
                    if (localEndTime) {
                        log('Ø¬Ø±Ø¨ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† localStorage...', 'warning');
                        testLocalStorageOnly();
                    } else {
                        document.getElementById('readStatus').textContent = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                        document.getElementById('readStatus').className = 'status error';
                    }
                } else {
                    throw new Error('REST API failed: ' + response.status);
                }
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ' + error.message, 'error');
                log('Ø¬Ø±Ø¨ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† localStorage...', 'warning');
                testLocalStorageOnly();
            }
        }

        // Delete countdown using REST API
        async function deleteCountdownREST() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŸ')) return;
            
            try {
                log('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯...');
                
                const url = `https://firestore.googleapis.com/v1/projects/${PROJECT_ID}/databases/(default)/documents/config/openingOffers?key=${API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok || response.status === 404) {
                    log('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase!', 'success');
                } else {
                    log('Firebase DELETE failed, clearing localStorage only', 'warning');
                }
                
                // Also clear localStorage
                localStorage.removeItem('openingOffers_endTime');
                localStorage.removeItem('openingOffers_isActive');
                
                log('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©!', 'success');
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯!');
                
                document.getElementById('readStatus').textContent = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                document.getElementById('readStatus').className = 'status error';
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ' + error.message, 'error');
                
                // At least clear localStorage
                localStorage.removeItem('openingOffers_endTime');
                localStorage.removeItem('openingOffers_isActive');
                log('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·', 'warning');
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Firebase ØºÙŠØ± Ù…ØªØ§Ø­)');
            }
        }

        // Clear localStorage
        function clearLocalStorage() {
            if (!confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŸ')) return;
            
            localStorage.removeItem('openingOffers_endTime');
            localStorage.removeItem('openingOffers_isActive');
            localStorage.removeItem('openingOffers_products');
            
            log('âœ“ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©!', 'success');
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
        }

        // Test localStorage only
        function testLocalStorageOnly() {
            const endTime = localStorage.getItem('openingOffers_endTime');
            const isActive = localStorage.getItem('openingOffers_isActive');
            
            if (endTime && isActive === 'true') {
                const remaining = parseInt(endTime) - new Date().getTime();
                
                if (remaining > 0) {
                    const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    log('âœ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage!', 'success');
                    log(`Ø§Ù„ÙˆÙ‚Øª: ${days} ÙŠÙˆÙ… ${hours}:${minutes}:${seconds}`);
                    
                    document.getElementById('readStatus').textContent = `ğŸ”§ Ù…Ø­Ù„ÙŠ: ${days} ÙŠÙˆÙ… ${hours}:${minutes}:${seconds}`;
                    document.getElementById('readStatus').className = 'status warning';
                } else {
                    log('Ø§Ù„ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ù‰ ÙÙŠ localStorage', 'warning');
                    document.getElementById('readStatus').textContent = 'ğŸ”§ Ø§Ù†ØªÙ‡Ù‰ Ù…Ø­Ù„ÙŠØ§Ù‹';
                    document.getElementById('readStatus').className = 'status warning';
                }
            } else {
                log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage', 'error');
                document.getElementById('readStatus').textContent = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                document.getElementById('readStatus').className = 'status error';
            }
        }

        // Initialize
        log('ØµÙØ­Ø© ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¬Ø§Ù‡Ø²Ø©', 'success');
        
        // Set default date to 7 days from now
        const defaultDate = new Date();
        defaultDate.setDate(defaultDate.getDate() + 7);
        document.getElementById('endDateInput').value = defaultDate.toISOString().slice(0, 16);
    </script>
</body>
</html>
