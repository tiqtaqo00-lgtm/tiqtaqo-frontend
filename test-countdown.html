<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ - TiqtaQo</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: #d4af37;
            text-align: center;
        }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #d4af37;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .warning { background: #f39c12; }
        button {
            background: #d4af37;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }
        button:hover {
            background: #f4d03f;
        }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯</h1>
    
    <div class="test-box">
        <h3>Ø§Ù„Ø­Ø§Ù„Ø©:</h3>
        <div id="firebaseStatus" class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
        <div id="readStatus" class="status warning">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
        <div id="writeStatus" class="status warning">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
    </div>
    
    <div class="test-box">
        <h3>Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ‚Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯:</h3>
        <label>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
        <input type="datetime-local" id="endDateInput" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button onclick="saveCountdown()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
        <button onclick="readCountdown()">ğŸ“– Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
        <button onclick="deleteCountdown()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
    </div>
    
    <div class="test-box">
        <h3>Ø§Ù„Ø³Ø¬Ù„:</h3>
        <div class="log" id="logBox">...</div>
    </div>

    <script type="module">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAmJp754L3V_AAUl6lV4LzE_dUCEFaX_nA",
            authDomain: "tiqtaqo-store.firebaseapp.com",
            projectId: "tiqtaqo-store",
            storageBucket: "tiqtaqo-store.firebasestorage.app",
            messagingSenderId: "747111253966",
            appId: "1:747111253966:web:84c265ac397b644fe28d9f"
        };

        let db = null;
        let app = null;

        function log(message, type = 'info') {
            const logBox = document.getElementById('logBox');
            const time = new Date().toLocaleTimeString();
            logBox.textContent += `[${time}] ${message}\n`;
            logBox.scrollTop = logBox.scrollHeight;
            console.log(message);
        }

        async function initFirebase() {
            try {
                log('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase...');
                
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
                const { getFirestore } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                log('âœ“ Firebase ØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                document.getElementById('firebaseStatus').textContent = 'âœ… Firebase Ù…ØªØµÙ„';
                document.getElementById('firebaseStatus').className = 'status success';
                
                return db;
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase: ' + error.message, 'error');
                document.getElementById('firebaseStatus').textContent = 'âŒ Firebase ØºÙŠØ± Ù…ØªØµÙ„';
                document.getElementById('firebaseStatus').className = 'status error';
                return null;
            }
        }

        // Make functions global
        window.initFirebase = initFirebase;
        window.db = db;

        // Auto-init
        initFirebase();
    </script>

    <script>
        async function saveCountdown() {
            const endDateInput = document.getElementById('endDateInput').value;
            if (!endDateInput) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!');
                return;
            }

            const endDate = new Date(endDateInput).getTime();
            
            try {
                document.getElementById('writeStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                document.getElementById('writeStatus').className = 'status warning';
                
                log('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase...');
                log('ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ' + new Date(endDate).toLocaleString());
                
                const { doc, setDoc, getDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                if (!window.db) {
                    await window.initFirebase();
                }
                
                const docRef = doc(window.db, 'config', 'openingOffers');
                
                // Save the data
                await setDoc(docRef, {
                    endTime: endDate,
                    isActive: true,
                    updatedAt: new Date().toISOString()
                });
                
                log('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // Verify the save
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    log('âœ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firebase', 'success');
                    log('  endTime: ' + data.endTime);
                    log('  isActive: ' + data.isActive);
                    log('  updatedAt: ' + data.updatedAt);
                } else {
                    log('âœ— Ø®Ø·Ø£: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙŠØ³Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø±ØºÙ… Ø§Ù„Ø­ÙØ¸!', 'error');
                }
                
                document.getElementById('writeStatus').textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
                document.getElementById('writeStatus').className = 'status success';
                
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ø¢Ù† Ø§ÙØªØ­ ØµÙØ­Ø© "ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©" Ù„ØªØ±Ù‰ Ø§Ù„Ø¹Ø¯Ø§Ø¯.');
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + error.message, 'error');
                document.getElementById('writeStatus').textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸';
                document.getElementById('writeStatus').className = 'status error';
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + error.message);
            }
        }

        async function readCountdown() {
            try {
                document.getElementById('readStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...';
                document.getElementById('readStatus').className = 'status warning';
                
                log('Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ù† Firebase...');
                
                const { doc, getDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                if (!window.db) {
                    await window.initFirebase();
                }
                
                const docRef = doc(window.db, 'config', 'openingOffers');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    log('âœ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯!', 'success');
                    log('  endTime: ' + data.endTime);
                    log('  isActive: ' + data.isActive);
                    log('  updatedAt: ' + data.updatedAt);
                    
                    // Calculate remaining time
                    const now = new Date().getTime();
                    const remaining = data.endTime - now;
                    
                    if (remaining > 0) {
                        const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                        
                        log(`  Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${days} ÙŠÙˆÙ… ${hours} Ø³Ø§Ø¹Ø© ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© ${seconds} Ø«Ø§Ù†ÙŠØ©`);
                    } else {
                        log('  Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
                    }
                    
                    document.getElementById('readStatus').textContent = 'âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    document.getElementById('readStatus').className = 'status success';
                } else {
                    log('âœ— Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase', 'error');
                    document.getElementById('readStatus').textContent = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                    document.getElementById('readStatus').className = 'status error';
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase!\n\nÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø­ÙØ¸ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù… ÙŠØ¹Ù…Ù„.');
                }
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ' + error.message, 'error');
                document.getElementById('readStatus').textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©';
                document.getElementById('readStatus').className = 'status error';
            }
        }

        async function deleteCountdown() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŸ')) return;
            
            try {
                log('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯...');
                
                const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                if (!window.db) {
                    await window.initFirebase();
                }
                
                const docRef = doc(window.db, 'config', 'openingOffers');
                
                await setDoc(docRef, {
                    endTime: null,
                    isActive: false,
                    deletedAt: new Date().toISOString()
                });
                
                log('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯!');
                
            } catch (error) {
                log('âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ' + error.message, 'error');
            }
        }

        // Set default date to 7 days from now
        const defaultDate = new Date();
        defaultDate.setDate(defaultDate.getDate() + 7);
        document.getElementById('endDateInput').value = defaultDate.toISOString().slice(0, 16);
    </script>
</body>
</html>
