<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Firebase - TiqTaQo</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="android-chrome-192x192" href="android-chrome-192x192.png">
    <link rel="android-chrome-512x512" href="android-chrome-512x512.png">

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, 
            collection,
            getDocs,
            getDoc,
            doc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAmJp754L3V_AAUl6lV4LzE_dUCEFaX_nA",
            authDomain: "tiqtaqo-store.firebaseapp.com",
            projectId: "tiqtaqo-store",
            storageBucket: "tiqtaqo-store.firebasestorage.app",
            messagingSenderId: "747111253966",
            appId: "1:747111253966:web:84c265ac397b644fe28d9f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Detailed test function
        window.runDiagnostics = async function() {
            const results = document.getElementById('results');
            results.innerHTML = '<div style="background: #1a1a2e; padding: 20px; border-radius: 10px; margin-top: 20px;"><h2 style="color: #ffc107;">ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ...</h2></div>';
            
            try {
                // Step 1: Check Firebase initialization
                results.innerHTML += '<div style="background: #2a2a4e; padding: 15px; border-radius: 8px; margin: 10px 0; border-right: 4px solid #28a745;"><p style="color: #28a745; margin: 5px 0;">âœ… 1. ØªÙ‡ÙŠØ¦Ø© Firebase: Ù†Ø¬Ø­</p></div>';
                
                // Step 2: Try to read products collection
                results.innerHTML += '<div style="background: #2a2a4e; padding: 15px; border-radius: 8px; margin: 10px 0;"><p style="color: #ffc107; margin: 5px 0;">â³ 2. Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p></div>';
                
                const productsRef = collection(db, 'products');
                const snapshot = await getDocs(productsRef);
                
                results.innerHTML += `<div style="background: #2a2a4e; padding: 15px; border-radius: 8px; margin: 10px 0; border-right: 4px solid #28a745;"><p style="color: #28a745; margin: 5px 0;">âœ… 3. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: Ù†Ø¬Ø­ - Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${snapshot.size}</p></div>`;
                
                if (snapshot.size === 0) {
                    results.innerHTML += `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-top: 20px; color: #856404;">
                            <h3 style="margin-top: 0;">âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©!</h3>
                            <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Firebase.</p>
                            <p><strong>Ø§Ù„Ø­Ù„:</strong> Ø£Ø¶Ù Ù…Ù†ØªØ¬ Ù…Ù† Ø®Ù„Ø§Ù„:</p>
                            <a href="add-product-direct.html" style="display: inline-block; margin-top: 10px; padding: 12px 24px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
                        </div>
                    `;
                } else {
                    let productsHtml = '';
                    let linksHtml = '';
                    
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        productsHtml += `
                            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 10px 0; border-right: 4px solid #28a745;">
                                <h4 style="margin: 0 0 10px 0; color: #155724;">${data.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h4>
                                <p style="margin: 5px 0;"><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${data.price || 0} Ø¯Ø±Ù‡Ù…</p>
                                <p style="margin: 5px 0;"><strong>Ø§Ù„ØªØµÙ†ÙŠÙ:</strong> ${data.category || 'Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ'}</p>
                                <p style="margin: 5px 0; color: #666; font-size: 12px;"><strong>Ø§Ù„Ù…Ø¹Ø±Ù:</strong> ${doc.id}</p>
                            </div>
                        `;
                        linksHtml += `<li style="margin: 10px 0;"><a href="product.html?id=${doc.id}" target="_blank" style="color: #007bff;">ğŸ“¦ ${data.name || doc.id}</a></li>`;
                    });
                    
                    results.inner <div style="HTML = `
                       background: #d4edda; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h3 style="color: #155724; margin-top: 0;">âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: <strong>${snapshot.size}</strong></p>
                            <div style="margin-top: 15px;">
                                ${productsHtml}
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 20px; background: #cce5ff; border-radius: 10px;">
                            <h4 style="color: #004085; margin-top: 0;">ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª:</h4>
                            <p style="color: #666; font-size: 12px;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†ØªØ¬ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡:</p>
                            <ul style="list-style: none; padding: 0;">
                                ${linksHtml}
                            </ul>
                        </div>
                    `;
                }
                
            } catch (error) {
                let errorType = 'Ø®Ø·Ø£ Ø¹Ø§Ù…';
                let errorSolution = '';
                
                if (error.code === 'permission-denied' || error.message.includes('permission')) {
                    errorType = 'ğŸ”´ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Firebase!';
                    errorSolution = `
                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin-top: 20px; color: #721c24;">
                            <h3 style="margin-top: 0;">${errorType}</h3>
                            <p><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Firebase ØªÙ…Ù†Ø¹ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.</p>
                            <p><strong>Ø§Ù„Ø­Ù„:</strong></p>
                            <ol style="text-align: right; padding-right: 20px;">
                                <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://console.firebase.google.com/" target="_blank" style="color: #007bff;">Firebase Console</a></li>
                                <li>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹ "tiqtaqo-store"</li>
                                <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Firestore Database" ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰</li>
                                <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ "Rules" (Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯)</li>
                                <li>Ø§Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØ¶Ø¹:</li>
                            </ol>
                            <pre style="background: #1a1a2e; color: #d4af37; padding: 15px; border-radius: 5px; text-align: left; overflow-x: auto;">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read: if true;
      allow write: if true;
    }
  }
}</pre>
                            <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Publish" (Ù†Ø´Ø±)</li>
                        </div>
                    `;
                } else if (error.code === 'unavailable') {
                    errorType = 'ğŸŸ¡ Ø®Ø¯Ù…Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©';
                    errorSolution = '<p>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
                } else if (error.code === 'resource-exhausted') {
                    errorType = 'ğŸŸ  ØªÙ… Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø­ØµØµ';
                    errorSolution = '<p>ØªÙ… ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ. Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
                }
                
                results.innerHTML = `
                    <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin-top: 20px; color: #721c24;">
                        <h3 style="margin-top: 0;">${errorType}</h3>
                        <p><strong>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                        <p><strong>Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£:</strong> ${error.code || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                        ${errorSolution}
                    </div>
                `;
                console.error('Firebase Error:', error);
            }
        };

        // Run test on load
        window.onload = runDiagnostics;
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        h1 {
            color: #d4af37;
            text-align: center;
            font-size: 28px;
        }
        .subtitle {
            color: #999;
            text-align: center;
            margin-bottom: 30px;
        }
        #results {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: #fff;
        }
        .refresh-btn {
            display: block;
            width: 250px;
            margin: 20px auto;
            padding: 15px 30px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #d4af37;
        }
        .info-box h3 {
            color: #d4af37;
            margin-top: 0;
        }
        .info-box p {
            color: #ccc;
            line-height: 1.8;
        }
        .home-link {
            display: block;
            text-align: center;
            margin-top: 30px;
            color: #d4af37;
            text-decoration: none;
        }
        .home-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ØªØ´Ø®ÙŠØµ Firebase Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
    <p class="subtitle">TiqTaQo Store - ØµÙØ­Ø© ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</p>
    
    <div class="info-box">
        <h3>â„¹ï¸ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø¯Ù‚Ø©. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ" Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§ØªØŒ Ø«Ù…:</p>
        <ul style="text-align: right; padding-right: 20px; color: #ccc;">
            <li>Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª âœ… Ø£Ø®Ø¶Ø±: Firebase ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</li>
            <li>Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª ğŸ”´ Ø£Ø­Ù…Ø±: Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</li>
            <li>Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª ğŸŸ¡ Ø£ØµÙØ±: Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</li>
        </ul>
    </div>
    
    <button class="refresh-btn" onclick="runDiagnostics()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ</button>
    
    <div id="results">
        <p style="color: #ffc107;">â³ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ´Ø®ÙŠØµ...</p>
    </div>
    
    <a href="index.html" class="home-link">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <script src="js/firebase-health-check.js"></script>
</body>
</html>
